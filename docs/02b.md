## Message Type Reference

### Session Management

| Type | Message | Direction | Response |
|------|---------|-----------|----------|
| VDSM_REQUEST_HELLO | vdsm_RequestHello | vdSM → vDC | vdc_ResponseHello |
| VDC_RESPONSE_HELLO | vdc_ResponseHello | vDC → vdSM | N/A |
| VDSM_SEND_BYE | vdsm_SendBye | vdSM → vDC | None |

#### vdsm_RequestHello
Open a session / handshake from the vdSM to the vDC. Contains client identification and protocol details.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Client-generated unique request identifier used to correlate responses. | "req-1234" |
| clientId | string | yes | Persistent id for the vdSM instance (e.g., UUID). | "vdsm-01" |
| protocolVersion | string | yes | Client protocol version (major.minor). | "2.0" |
| clientCapabilities | object | no | Key/value map of client capabilities (optional). | {"scenes": true} |
| timestamp | string (ISO-8601) | no | Client local time for diagnostics. | "2026-01-09T12:34:56Z" |

Notes
- Server replies with vdc_ResponseHello on success or a GenericResponse on error.
- requestId should be unique per outstanding request; response echoes it.
- If protocolVersion is incompatible the server should include recommended version information.

#### vdc_ResponseHello
Response from the vDC containing negotiated parameters and server identification.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Echoes the requestId from vdsm_RequestHello. | "req-1234" |
| serverId | string | yes | Server identifier. | "vdc-main-01" |
| protocolVersion | string | yes | Negotiated protocol version. | "2.0" |
| serverTime | string (ISO-8601) | yes | Server timestamp when response was generated. | "2026-01-09T12:34:57Z" |
| status | string | yes | "ok" or an error short code. | "ok" |
| details | object | no | Additional details or server capabilities (optional). | {"maxPayload": 1048576} |

Notes
- If status != "ok", details should include an explanation and any recommended action.
- Successful hello establishes the session for the clientId.

#### vdsm_SendBye
Graceful session close initiated by the vdSM.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| clientId | string | yes | The client id that is closing the session. | "vdsm-01" |
| reason | string | no | Optional textual reason for disconnect. | "shutdown" |
| timestamp | string (ISO-8601) | no | Time of disconnect. | "2026-01-09T12:45:00Z" |

Notes
- This is a best-effort notification; the server may close the connection and is not required to reply.

---

### Property Access

| Type | Message | Direction | Response |
|------|---------|-----------|----------|
| VDSM_REQUEST_GET_PROPERTY | vdsm_RequestGetProperty | vdSM → vDC | vdc_ResponseGetProperty |
| VDC_RESPONSE_GET_PROPERTY | vdc_ResponseGetProperty | vDC → vdSM | N/A |
| VDSM_REQUEST_SET_PROPERTY | vdsm_RequestSetProperty | vdSM → vDC | GenericResponse |
| VDC_SEND_PUSH_PROPERTY | vdc_SendPushProperty | vDC → vdSM | Error only |
| VDC_SEND_PUSH_NOTIFICATION | vdc_SendPushNotification | vDC → vdSM | Error only |

#### vdsm_RequestGetProperty
Request one or more property values from the vDC.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Unique request id. | "get-001" |
| propertyPath | string | yes | Dot-separated path to the property (or wildcard). | "devices.device123.channel.1.value" |
| attributes | array of string | no | Optional attributes to include (e.g., ["timestamp","quality"]). | ["timestamp"] |

Notes
- Server replies with vdc_ResponseGetProperty (or GenericResponse on error).
- propertyPath semantics (support for wildcards, ranges) depend on server capabilities.

#### vdc_ResponseGetProperty
Response containing property value(s) and optional metadata.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Echo of requestId. | "get-001" |
| results | array | yes | Array of property result objects. | see fields below |
| status | string | yes | "ok" or an error short code. | "ok" |
| timestamp | string (ISO-8601) | yes | Server time when response was produced. | "2026-01-09T12:35:00Z" |

Result object fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| path | string | yes | Property path returned. | "devices.device123.channel.1.value" |
| value | any | yes | Property value. | 75 |
| type | string | no | Data type of the value (informational). | "integer" |
| attributes | object | no | Additional metadata (timestamp, quality, etc.). | {"timestamp":"2026-01-09T12:34:59Z"} |
| error | object | no | Per-item error details if unable to fetch value. | {"message":"not found"} |

Notes
- For partial failures the results array may include entries with error objects.
- Bulk responses may be paged by the server if very large.

#### vdsm_RequestSetProperty
Request to set one or more property values on the vDC.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Unique request id. | "set-001" |
| changes | array | yes | Array of change objects {path, value, type?, priority?}. | see change object below |
| transactional | boolean | no | If true, apply all-or-none semantics if supported. | true |

Change object fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| path | string | yes | Property path to set. | "devices.device123.channel.1.value" |
| value | any | yes | Value to write. | 0.5 |
| type | string | no | Optional type hint. | "float" |
| priority | integer | no | Optional priority for the change (source precedence). | 100 |

Notes
- Server responds with GenericResponse indicating overall and/or per-change status.
- If transactional=true, the server should attempt to roll back on failure when possible; behavior is implementation-dependent.

#### vdc_SendPushProperty
Server-initiated push notifying clients about property updates (unsolicited).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| timestamp | string (ISO-8601) | yes | Time of the change. | "2026-01-09T12:35:05Z" |
| updates | array | yes | Array of update objects similar to get results: {path, value, type, attributes}. | see result object fields above |

Notes
- Pushes are typically not acknowledged; error handling and retries depend on transport and server policy.
- Clients must be prepared to receive high-frequency updates for busy systems.

#### vdc_SendPushNotification
Server push for non-property notifications (alarms, events, informational messages).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| eventId | string | yes | Unique event identifier. | "evt-20260109-01" |
| eventType | string | yes | Event type identifier (alarm, info, maintenance...). | "alarm" |
| severity | string | no | Severity classification (info/warn/error). | "warn" |
| payload | object | no | Event-specific payload. | {"message":"temp high"} |
| timestamp | string (ISO-8601) | yes | Event timestamp. | "2026-01-09T12:36:00Z" |

Notes
- Clients should act on events according to type/severity; important events may require explicit client acknowledgement via separate message patterns (implementation-specific).

---

### Device Lifecycle

| Type | Message | Direction | Response |
|------|---------|-----------|----------|
| VDC_SEND_ANNOUNCE_VDC | vdc_SendAnnounceVdc | vDC → vdSM | Error only |
| VDC_SEND_ANNOUNCE_DEVICE | vdc_SendAnnounceDevice | vDC → vdSM | Error only |
| VDC_SEND_VANISH | vdc_SendVanish | vDC → vdSM | Error only |
| VDSM_SEND_REMOVE | vdsm_SendRemove | vdSM → vDC | None |
| VDC_SEND_IDENTIFY | vdc_SendIdentify | vDC → vdSM | Error only |

#### vdc_SendAnnounceVdc
Announce a vDC instance (topology/availability) to clients.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| vdcId | string | yes | Unique vDC identifier. | "vdc-01" |
| name | string | no | Human-readable name for the vDC. | "Main vDC" |
| capabilities | object | no | Features/capabilities advertised by the vDC. | {"propertyPush": true} |
| timestamp | string (ISO-8601) | yes | Announcement time. | "2026-01-09T12:40:00Z" |

Notes
- Clients may cache announcements and adapt routing/UI behavior.
- Announcements can be periodic or sent on topology changes.

#### vdc_SendAnnounceDevice
Announce device presence or metadata changes.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| deviceId | string | yes | Unique device identifier. | "device123" |
| name | string | yes | Device human-readable name. | "Light Panel 01" |
| type | string | no | Device type identifier. | "dimmer" |
| channels | integer | no | Number of channels the device exposes. | 4 |
| metadata | object | no | Arbitrary metadata like location/vendor. | {"location":"conference"} |
| timestamp | string (ISO-8601) | yes | Announcement time. | "2026-01-09T12:41:00Z" |

Notes
- Clients should merge announcements with existing device state rather than replace blindly.
- Announcements may drive device discovery UIs.

#### vdc_SendVanish
Notify that a device or vDC is no longer available.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| targetType | string | yes | "device" or "vdc". | "device" |
| targetId | string | yes | Id of the vanished target. | "device123" |
| reason | string | no | Optional reason for vanishing. | "disconnected" |
| timestamp | string (ISO-8601) | yes | Time of vanish. | "2026-01-09T12:50:00Z" |

Notes
- Clients should mark targets offline and cease control operations addressed to them.

#### vdsm_SendRemove
Client-initiated request to remove/unbind a device.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Unique request id for tracking. | "rm-001" |
| deviceId | string | yes | Device to remove/unbind. | "device123" |
| reason | string | no | Optional reason for removal. | "decommission" |

Notes
- Server may reply with a GenericResponse indicating success or failure.
- Removal typically implies the device will no longer be announced.

#### vdc_SendIdentify
Request that clients/devices perform an identification action (blink/beep).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| target | string | yes | Device id, group id or wildcard identifying targets. | "device123" |
| duration | integer (seconds) | no | Duration of identify action. | 5 |
| method | string | no | Method to use (blink, beep, etc.). | "blink" |
| timestamp | string (ISO-8601) | no | Time request was issued. | "2026-01-09T12:42:00Z" |

Notes
- Identify requests are informational; clients/devices that cannot perform identification may ignore them.

---

### Keep-Alive

| Type | Message | Direction | Response |
|------|---------|-----------|----------|
| VDSM_SEND_PING | vdsm_SendPing | vdSM → vDC | vdc_SendPong |
| VDC_SEND_PONG | vdc_SendPong | vDC → vdSM | N/A |

#### vdsm_SendPing
Health-check ping from the client to the server.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| pingId | string | yes | Unique ping identifier. | "ping-42" |
| timestamp | string (ISO-8601) | yes | Client timestamp for latency measurements. | "2026-01-09T12:46:00Z" |

Notes
- Server should reply with vdc_SendPong echoing pingId and including server time.

#### vdc_SendPong
Pong response including timing information.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| pingId | string | yes | Echo of the client's pingId. | "ping-42" |
| serverTime | string (ISO-8601) | yes | Server timestamp. | "2026-01-09T12:46:00Z" |
| status | string | yes | "ok" or an error short code. | "ok" |

Notes
- Useful for latency and round-trip checks; servers may include additional diagnostics in the response details if required.

---

### Notifications (Scene Operations)

All notifications: vdSM → vDC, no response expected

| Type | Message | Purpose |
|------|---------|---------|
| VDSM_NOTIFICATION_CALL_SCENE | vdsm_NotificationCallScene | Activate scene |
| VDSM_NOTIFICATION_SAVE_SCENE | vdsm_NotificationSaveScene | Save current state as scene |
| VDSM_NOTIFICATION_UNDO_SCENE | vdsm_NotificationUndoScene | Undo scene |
| VDSM_NOTIFICATION_SET_LOCAL_PRIO | vdsm_NotificationSetLocalPrio | Set local priority |
| VDSM_NOTIFICATION_CALL_MIN_SCENE | vdsm_NotificationCallMinScene | Call minimum scene |
| VDSM_NOTIFICATION_IDENTIFY | vdsm_NotificationIdentify | Identify device(s) |
| VDSM_NOTIFICATION_SET_CONTROL_VALUE | vdsm_NotificationSetControlValue | Set control value |
| VDSM_NOTIFICATION_DIM_CHANNEL | vdsm_NotificationDimChannel | Dim channel |
| VDSM_NOTIFICATION_SET_OUTPUT_CHANNEL_VALUE | vdsm_NotificationSetOutputChannelValue | Set channel value |

Shared notification header (if present)
| Field | Type | Required | Example |
|---|---:|:---:|---|
| notificationId | string | no | "notif-001" |
| source | string | no | "ui" |
| timestamp | string (ISO-8601) | no | "2026-01-09T12:47:00Z" |

#### vdsm_NotificationCallScene
Activate (call) a scene.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| sceneId | string | yes | Scene identifier to call. | "scene-entrance" |
| priority | integer | no | Execution priority for the call. | 200 |
| transition | number (seconds) | no | Optional fade/transition time. | 1.5 |

Notes
- This is fire-and-forget; server applies scene following priority rules. Errors are reported asynchronously (if at all).

#### vdsm_NotificationSaveScene
Save the current state as a scene (create or overwrite).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| sceneId | string | yes | Identifier to save the scene under. | "scene-meeting" |
| scope | string | no | Scope of scene ("global", "local", specific area). | "global" |
| description | string | no | Human-readable description of the scene. | "Meeting preset" |

Notes
- Server may respond later with status via push notification; immediate acknowledgment is not expected.

#### vdsm_NotificationUndoScene
Undo the last scene call or a specific scene.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| sceneId | string | no | Optional specific scene id to undo. | "scene-entrance" |
| timestamp | string (ISO-8601) | no | When the undo request was issued. | "2026-01-09T12:49:00Z" |

Notes
- Undo depends on server-side scene history support.

#### vdsm_NotificationSetLocalPrio
Set a local control priority for the initiator.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| priority | integer | yes | Local priority value to set. | 250 |
| duration | integer (seconds) | no | How long the local priority remains in effect. | 300 |

Notes
- Local priority influences handling of subsequent control requests originating from the same source.

#### vdsm_NotificationCallMinScene
Request to call a minimal/default scene (implementation-specific).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| scope | string | no | Optional scope for the minimum scene (area/group). | "area-1" |

Notes
- Typically used to quickly revert to a safe or minimal lighting state.

#### vdsm_NotificationIdentify
Client-initiated identify request for devices.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| target | string | yes | Device id or wildcard identifying targets. | "device123" |
| duration | integer (seconds) | no | Duration for identify action. | 10 |

Notes
- Similar semantics to vdc_SendIdentify but initiated by the vdSM.

#### vdsm_NotificationSetControlValue
Notification to set a control value (transient semantics).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| target | string | yes | Device or channel path to control. | "devices.device123.channel.1" |
| value | any | yes | Control value to apply (type depends on channel). | 0.75 |
| duration | number (seconds) | no | Ramp or fade time. | 0.5 |

Notes
- As a notification the change may be transient; persistent changes should use vdsm_RequestSetProperty.

#### vdsm_NotificationDimChannel
Dim a channel (absolute or relative).

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| channel | string | yes | Channel path to dim. | "devices.device123.channel.2" |
| value | number | yes | Target value (0–1) or delta if mode=relative. | 0.5 |
| mode | string | no | "absolute" or "relative". | "absolute" |

Notes
- Devices may not support all modes; clients should handle capability differences.

#### vdsm_NotificationSetOutputChannelValue
Set a hardware output channel value (direct output control).

Fields (same shape as SetControlValue, targeted at outputs)
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| target | string | yes | Output channel path. | "outputs.device123.channel.1" |
| value | any | yes | Output value to set (ranges/types depend on hardware). | 255 |

Notes
- Logical control channels and hardware outputs may diverge; choose appropriate target path.

---

### Generic Request (API v2c+)

| Type | Message | Direction | Response |
|------|---------|-----------|----------|
| VDSM_REQUEST_GENERIC_REQUEST | vdsm_RequestGenericRequest | vdSM → vDC | GenericResponse |

#### vdsm_RequestGenericRequest
Generic RPC-style request to invoke an extension or named operation on the vDC.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | Unique request identifier. | "gr-001" |
| method | string | yes | Method/operation name to invoke (extension point). | "device.reboot" |
| params | object | no | Method parameters. | {"deviceId":"device123","force":true} |
| timeout | integer (ms) | no | Optional client-side timeout. | 5000 |

Notes
- Server replies with GenericResponse containing status and optional result or error.
- Used to extend the API without changing core message schemas.

---

## Common response: GenericResponse

| Property | Value |
|---|---|
| Name | GenericResponse |
| Topic | response/generic |
| Direction | vDC → vdSM |
| Version | 1.0 |
| Summary | Standard response envelope for requests which do not have a dedicated response message. |

#### GenericResponse
Standard response envelope for operations that do not have a dedicated response.

Fields
| Field | Type | Required | Description | Example |
|---|---:|:---:|---|---|
| requestId | string | yes | The request id being answered. | "set-001" |
| status | string | yes | "ok" or an error short code. | "ok" |
| code | integer | no | Numeric status code (optional). | 200 |
| result | object | no | Result payload for successful operations. | {"applied":1} |
| error | object | no | Error details if status != "ok". | {"message":"not found","details":{}} |
| timestamp | string (ISO-8601) | yes | Server response time. | "2026-01-09T12:53:00Z" |

Notes
- GenericResponse is used by vdsm_RequestSetProperty, vdsm_RequestGenericRequest and other operations that map to a shared response envelope.
- For batch operations the result field may contain per-item statuses or a structured result object.
